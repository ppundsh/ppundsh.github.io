// build time:Sun Apr 15 2018 05:29:31 GMT+0800 (台北標準時間)
(function(t){"use strict";var i,e,s=Math.abs,h=Math.sin,n=Math.cos,a=Math.max,o=Math.min,r=Math.ceil,l=Math.sqrt,f=Math.pow,u={},g={},c={0:"0,",1:"17,",2:"34,",3:"51,",4:"68,",5:"85,",6:"102,",7:"119,",8:"136,",9:"153,",a:"170,",A:"170,",b:"187,",B:"187,",c:"204,",C:"204,",d:"221,",D:"221,",e:"238,",E:"238,",f:"255,",F:"255,"},d,m,p,w,x,v,y,T=document,S,b={};for(i=0;i<256;++i){e=i.toString(16);if(i<16)e="0"+e;g[e]=g[e.toUpperCase()]=i.toString()+","}function C(t){return typeof t!="undefined"}function z(t){return typeof t=="object"&&t!=null}function D(t,i,e){return isNaN(t)?e:o(e,a(i,t))}function A(){return false}function I(){return(new Date).valueOf()}function M(t,i){var e=[],s=t.length,h;for(h=0;h<s;++h)e.push(t[h]);e.sort(i);return e}function F(t){var i=t.length-1,e,s;while(i){s=~~(Math.random()*i);e=t[i];t[i]=t[s];t[s]=e;--i}}function O(t,i,e){this.x=t;this.y=i;this.z=e}x=O.prototype;x.length=function(){return l(this.x*this.x+this.y*this.y+this.z*this.z)};x.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z};x.cross=function(t){var i=this.y*t.z-this.z*t.y,e=this.z*t.x-this.x*t.z,s=this.x*t.y-this.y*t.x;return new O(i,e,s)};x.angle=function(t){var i=this.dot(t),e;if(i==0)return Math.PI/2;e=i/(this.length()*t.length());if(e>=1)return 0;if(e<=-1)return Math.PI;return Math.acos(e)};x.unit=function(){var t=this.length();return new O(this.x/t,this.y/t,this.z/t)};function k(t,i){i=i*Math.PI/180;t=t*Math.PI/180;var e=h(t)*n(i),s=-h(i),a=-n(t)*n(i);return new O(e,s,a)}function P(t){this[1]={1:t[0],2:t[1],3:t[2]};this[2]={1:t[3],2:t[4],3:t[5]};this[3]={1:t[6],2:t[7],3:t[8]}}w=P.prototype;P.Identity=function(){return new P([1,0,0,0,1,0,0,0,1])};P.Rotation=function(t,i){var e=h(t),s=n(t),a=1-s;return new P([s+f(i.x,2)*a,i.x*i.y*a-i.z*e,i.x*i.z*a+i.y*e,i.y*i.x*a+i.z*e,s+f(i.y,2)*a,i.y*i.z*a-i.x*e,i.z*i.x*a-i.y*e,i.z*i.y*a+i.x*e,s+f(i.z,2)*a])};w.mul=function(t){var i=[],e,s,h=t.xform?1:0;for(e=1;e<=3;++e)for(s=1;s<=3;++s){if(h)i.push(this[e][1]*t[1][s]+this[e][2]*t[2][s]+this[e][3]*t[3][s]);else i.push(this[e][s]*t)}return new P(i)};w.xform=function(t){var i={},e=t.x,s=t.y,h=t.z;i.x=e*this[1][1]+s*this[2][1]+h*this[3][1];i.y=e*this[1][2]+s*this[2][2]+h*this[3][2];i.z=e*this[1][3]+s*this[2][3]+h*this[3][3];return i};function E(t,i,e,s,a){var o,r,f,u,g=[],c=2/t,d;d=Math.PI*(3-l(5)+(parseFloat(a)?parseFloat(a):0));for(o=0;o<t;++o){r=o*c-1+c/2;f=l(1-r*r);u=o*d;g.push([n(u)*f*i,r*e,h(u)*f*s])}return g}function R(t,i,e,s,a,o){var r,f=[],u=2/t,g,c,d,m,p;g=Math.PI*(3-l(5)+(parseFloat(o)?parseFloat(o):0));for(c=0;c<t;++c){d=c*u-1+u/2;r=c*g;m=n(r);p=h(r);f.push(i?[d*e,m*s,p*a]:[m*e,d*s,p*a])}return f}function B(t,i,e,s,a,o){var r,l=[],f=Math.PI*2/i,u,g,c;for(u=0;u<i;++u){r=u*f;g=n(r);c=h(r);l.push(t?[o*e,g*s,c*a]:[g*e,o*s,c*a])}return l}function N(t,i,e,s,h){return R(t,0,i,e,s,h)}function _(t,i,e,s,h){return R(t,1,i,e,s,h)}function L(t,i,e,s,h){h=isNaN(h)?0:h*1;return B(0,t,i,e,s,h)}function H(t,i,e,s,h){h=isNaN(h)?0:h*1;return B(1,t,i,e,s,h)}function W(t){var i=new Image;i.onload=function(){var e=i.width/2,s=i.height/2;t.centreFunc=function(t,h,n,a,o){t.setTransform(1,0,0,1,0,0);t.globalAlpha=1;t.drawImage(i,a-e,o-s)}};i.src=t.centreImage}function X(t,i){var e=t,s,h,n=(i*1).toPrecision(3)+")";if(t[0]==="#"){if(!u[t])if(t.length===4)u[t]="rgba("+c[t[1]]+c[t[2]]+c[t[3]];else u[t]="rgba("+g[t.substr(1,2)]+g[t.substr(3,2)]+g[t.substr(5,2)];e=u[t]+n}else if(t.substr(0,4)==="rgb("||t.substr(0,4)==="hsl("){e=t.replace("(","a(").replace(")",","+n)}else if(t.substr(0,5)==="rgba("||t.substr(0,5)==="hsla("){s=t.lastIndexOf(",")+1,h=t.indexOf(")");i*=parseFloat(t.substring(s,h));e=t.substr(0,s)+i.toPrecision(3)+")"}return e}function Y(t,i){if(window.G_vmlCanvasManager)return null;var e=T.createElement("canvas");e.width=t;e.height=i;return e}function U(){var t=Y(3,3),i,e;if(!t)return false;i=t.getContext("2d");i.strokeStyle="#000";i.shadowColor="#fff";i.shadowBlur=3;i.globalAlpha=0;i.strokeRect(2,2,2,2);i.globalAlpha=1;e=i.getImageData(2,2,1,1);t=null;return e.data[0]>0}function V(t,i,e,s){var h=t.createLinearGradient(0,0,i,0),n;for(n in s)h.addColorStop(1-n,s[n]);t.fillStyle=h;t.fillRect(0,e,i,1)}function q(t,i,e){var s=1024,h=1,n=t.weightGradient,r,l,f,u;if(t.gCanvas){l=t.gCanvas.getContext("2d");h=t.gCanvas.height}else{if(z(n[0]))h=n.length;else n=[n];t.gCanvas=r=Y(s,h);if(!r)return null;l=r.getContext("2d");for(f=0;f<h;++f)V(l,s,f,n[f])}e=a(o(e||0,h-1),0);u=l.getImageData(~~((s-1)*i),e,1,1).data;return"rgba("+u[0]+","+u[1]+","+u[2]+","+u[3]/255+")"}function G(t,i,e,h,n,a,o,r,l,f,u,g){var c=n+(r||0)+(l.length&&l[0]<0?s(l[0]):0),d=a+(r||0)+(l.length&&l[1]<0?s(l[1]):0),m,p;t.font=i;t.textBaseline="top";t.fillStyle=e;o&&(t.shadowColor=o);r&&(t.shadowBlur=r);l.length&&(t.shadowOffsetX=l[0],t.shadowOffsetY=l[1]);for(m=0;m<h.length;++m){p=0;if(u){if("right"==g){p=f-u[m]}else if("centre"==g){p=(f-u[m])/2}}t.fillText(h[m],c+p,d);d+=parseInt(i)}}function j(t,i,e,s,h,n,a){if(n){t.beginPath();t.moveTo(i,e+h-n);t.arcTo(i,e,i+n,e,n);t.arcTo(i+s,e,i+s,e+n,n);t.arcTo(i+s,e+h,i+s-n,e+h,n);t.arcTo(i,e+h,i,e+h-n,n);t.closePath();t[a?"stroke":"fill"]()}else{t[a?"strokeRect":"fillRect"](i,e,s,h)}}function Z(t,i,e,s,h,n,a,o,r){this.strings=t;this.font=i;this.width=e;this.height=s;this.maxWidth=h;this.stringWidths=n;this.align=a;this.valign=o;this.scale=r}y=Z.prototype;y.SetImage=function(t,i,e,s,h,n,a,o){this.image=t;this.iwidth=i*this.scale;this.iheight=e*this.scale;this.ipos=s;this.ipad=h*this.scale;this.iscale=o;this.ialign=n;this.ivalign=a};y.Align=function(t,i,e){var s=0;if(e=="right"||e=="bottom")s=i-t;else if(e!="left"&&e!="top")s=(i-t)/2;return s};y.Create=function(t,i,e,h,n,r,l,f,u){var g,c,d,m,p,w,x,v,y,T,S,b,C,z,D,A=s(l[0]),I=s(l[1]),M,F;f=a(f,A+r,I+r);p=2*(f+h);x=2*(f+h);c=this.width+p;d=this.height+x;y=T=f+h;if(this.image){S=b=f+h;C=this.iwidth;z=this.iheight;if(this.ipos=="top"||this.ipos=="bottom"){if(C<this.width)S+=this.Align(C,this.width,this.ialign);else y+=this.Align(this.width,C,this.align);if(this.ipos=="top")T+=z+this.ipad;else b+=this.height+this.ipad;c=a(c,C+p);d+=z+this.ipad}else{if(z<this.height)b+=this.Align(z,this.height,this.ivalign);else T+=this.Align(this.height,z,this.valign);if(this.ipos=="right")S+=this.width+this.ipad;else y+=C+this.ipad;c+=C+this.ipad;d=a(d,z+x)}}g=Y(c,d);if(!g)return null;p=x=h/2;w=c-h;v=d-h;D=o(u,w/2,v/2);m=g.getContext("2d");if(i){m.fillStyle=i;j(m,p,x,w,v,D)}if(h){m.strokeStyle=e;m.lineWidth=h;j(m,p,x,w,v,D,true)}if(r||A||I){M=Y(c,d);if(M){F=m;m=M.getContext("2d")}}G(m,this.font,t,this.strings,y,T,0,0,[],this.maxWidth,this.stringWidths,this.align);if(this.image)m.drawImage(this.image,S,b,C,z);if(F){m=F;n&&(m.shadowColor=n);r&&(m.shadowBlur=r);m.shadowOffsetX=l[0];m.shadowOffsetY=l[1];m.drawImage(M,0,0)}return g};function Q(t,i,e){var s=Y(i,e),h;if(!s)return null;h=s.getContext("2d");h.drawImage(t,(i-t.width)/2,(e-t.height)/2);return s}function J(t,i,e){var s=Y(i,e),h;if(!s)return null;h=s.getContext("2d");h.drawImage(t,0,0,i,e);return s}function K(t,i,e,s,h,n,a,r,l,f){var u=i+(2*r+n)*s,g=e+(2*r+n)*s,c=Y(u,g),d,m,p,w,x,v,y,T;if(!c)return null;n*=s;l*=s;m=p=n/2;w=u-n;x=g-n;r=r*s+m;d=c.getContext("2d");T=o(l,w/2,x/2);if(h){d.fillStyle=h;j(d,m,p,w,x,T)}if(n){d.strokeStyle=a;d.lineWidth=n;j(d,m,p,w,x,T,true)}if(f){v=Y(u,g);y=v.getContext("2d");y.drawImage(t,r,r,i,e);y.globalCompositeOperation="source-in";y.fillStyle=a;y.fillRect(0,0,u,g);y.globalCompositeOperation="destination-over";y.drawImage(c,0,0);y.globalCompositeOperation="source-over";d.drawImage(v,0,0)}else{d.drawImage(t,r,r,t.width,t.height)}return{image:c,width:u/s,height:g/s}}function $(t,i,e,s,h){var n,r,l=parseFloat(i),f=a(e,s);n=Y(e,s);if(!n)return null;if(i.indexOf("%")>0)l=f*l/100;else l=l*h;r=n.getContext("2d");r.globalCompositeOperation="source-over";r.fillStyle="#fff";if(l>=f/2){l=o(e,s)/2;r.beginPath();r.moveTo(e/2,s/2);r.arc(e/2,s/2,l,0,2*Math.PI,false);r.fill();r.closePath()}else{l=o(e/2,s/2,l);j(r,0,0,e,s,l,true);r.fill()}r.globalCompositeOperation="source-in";r.drawImage(t,0,0,e,s);return n}function tt(t,i,e,h,n,a,o){var r=s(o[0]),l=s(o[1]),f=i+(r>a?r+a:a*2)*h,u=e+(l>a?l+a:a*2)*h,g=h*((a||0)+(o[0]<0?r:0)),c=h*((a||0)+(o[1]<0?l:0)),d,m;d=Y(f,u);if(!d)return null;m=d.getContext("2d");n&&(m.shadowColor=n);a&&(m.shadowBlur=a*h);o&&(m.shadowOffsetX=o[0]*h,m.shadowOffsetY=o[1]*h);m.drawImage(t,g,c,i,e);return{image:d,width:f/h,height:u/h}}function it(t,i,e){var s=parseInt(t.toString().length*e),h=parseInt(e*2*t.length),n=Y(s,h),a,o,r,l,f,u,g,c;if(!n)return null;a=n.getContext("2d");a.fillStyle="#000";a.fillRect(0,0,s,h);G(a,e+"px "+i,"#fff",t,0,0,0,0,[],"centre");o=a.getImageData(0,0,s,h);r=o.width;l=o.height;c={min:{x:r,y:l},max:{x:-1,y:-1}};for(u=0;u<l;++u){for(f=0;f<r;++f){g=(u*r+f)*4;if(o.data[g+1]>0){if(f<c.min.x)c.min.x=f;if(f>c.max.x)c.max.x=f;if(u<c.min.y)c.min.y=u;if(u>c.max.y)c.max.y=u}}}if(r!=s){c.min.x*=s/r;c.max.x*=s/r}if(l!=h){c.min.y*=s/l;c.max.y*=s/l}n=null;return c}function et(t){return"'"+t.replace(/(\'|\")/g,"").replace(/\s*,\s*/g,"', '")+"'"}function st(t,i,e){e=e||T;if(e.addEventListener)e.addEventListener(t,i,false);else e.attachEvent("on"+t,i)}function ht(t,i,e){e=e||T;if(e.removeEventListener)e.removeEventListener(t,i);else e.detachEvent("on"+t,i)}function nt(t,i,e,s){var h=s.imageScale,n,a,o,r,l,f;if(!i.complete)return st("load",function(){nt(t,i,e,s)},i);if(!t.complete)return st("load",function(){nt(t,i,e,s)},t);i.width=i.width;i.height=i.height;if(h){t.width=i.width*h;t.height=i.height*h}e.iw=t.width;e.ih=t.height;if(s.txtOpt){a=t;n=s.zoomMax*s.txtScale;l=e.iw*n;f=e.ih*n;if(l<i.naturalWidth||f<i.naturalHeight){a=J(t,l,f);if(a)e.fimage=a}else{l=e.iw;f=e.ih;n=1}if(parseFloat(s.imageRadius))e.image=e.fimage=t=$(e.image,s.imageRadius,l,f,n);if(!e.HasText()){if(s.shadow){a=tt(e.image,l,f,n,s.shadow,s.shadowBlur,s.shadowOffset);if(a){e.fimage=a.image;e.w=a.width;e.h=a.height}}if(s.bgColour||s.bgOutlineThickness){o=s.bgColour=="tag"?at(e.a,"background-color"):s.bgColour;r=s.bgOutline=="tag"?at(e.a,"color"):s.bgOutline||s.textColour;l=e.fimage.width;f=e.fimage.height;if(s.outlineMethod=="colour"){a=K(e.fimage,l,f,n,o,s.bgOutlineThickness,e.outline.colour,s.padding,s.bgRadius,1);if(a)e.oimage=a.image}a=K(e.fimage,l,f,n,o,s.bgOutlineThickness,r,s.padding,s.bgRadius);if(a){e.fimage=a.image;e.w=a.width;e.h=a.height}}if(s.outlineMethod=="size"){if(s.outlineIncrease>0){e.iw+=2*s.outlineIncrease;e.ih+=2*s.outlineIncrease;l=n*e.iw;f=n*e.ih;a=J(e.fimage,l,f);e.oimage=a;e.fimage=Q(e.fimage,e.oimage.width,e.oimage.height)}else{l=n*(e.iw+2*s.outlineIncrease);f=n*(e.ih+2*s.outlineIncrease);a=J(e.fimage,l,f);e.oimage=Q(a,e.fimage.width,e.fimage.height)}}}}e.Init()}function at(t,i){var e=T.defaultView,s=i.replace(/\-([a-z])/g,function(t){return t.charAt(1).toUpperCase()});return e&&e.getComputedStyle&&e.getComputedStyle(t,null).getPropertyValue(i)||t.currentStyle&&t.currentStyle[s]}function ot(t,i,e){var s=1,h;if(i){s=1*(t.getAttribute(i)||e)}else if(h=at(t,"font-size")){s=h.indexOf("px")>-1&&h.replace("px","")*1||h.indexOf("pt")>-1&&h.replace("pt","")*1.25||h*3.3}return s}function rt(t){return t.target&&C(t.target.id)?t.target.id:t.srcElement.parentNode.id}function lt(t,i){var e,s,h=parseInt(at(i,"width"))/i.width,n=parseInt(at(i,"height"))/i.height;if(C(t.offsetX)){e={x:t.offsetX,y:t.offsetY}}else{s=Tt(i.id);if(C(t.changedTouches))t=t.changedTouches[0];if(t.pageX)e={x:t.pageX-s.x,y:t.pageY-s.y}}if(e&&h&&n){e.x/=h;e.y/=n}return e}function ft(t){var i=t.target||t.fromElement.parentNode,e=Dt.tc[i.id];if(e){e.mx=e.my=-1;e.UnFreeze();e.EndDrag()}}function ut(t){var i,e=Dt,s,h,n=rt(t);for(i in e.tc){s=e.tc[i];if(s.tttimer){clearTimeout(s.tttimer);s.tttimer=null}}if(n&&e.tc[n]){s=e.tc[n];if(h=lt(t,s.canvas)){s.mx=h.x;s.my=h.y;s.Drag(t,h)}s.drawn=0}}function gt(t){var i=Dt,e=T.addEventListener?0:1,s=rt(t);if(s&&t.button==e&&i.tc[s]){i.tc[s].BeginDrag(t)}}function ct(t){var i=Dt,e=T.addEventListener?0:1,s=rt(t),h;if(s&&t.button==e&&i.tc[s]){h=i.tc[s];ut(t);if(!h.EndDrag()&&!h.touchState)h.Clicked(t)}}function dt(t){var i=rt(t),e=i&&Dt.tc[i],s;if(e&&t.changedTouches){if(t.touches.length==1&&e.touchState==0){e.touchState=1;e.BeginDrag(t);if(s=lt(t,e.canvas)){e.mx=s.x;e.my=s.y;e.drawn=0}}else if(t.targetTouches.length==2&&e.pinchZoom){e.touchState=3;e.EndDrag();e.BeginPinch(t)}else{e.EndDrag();e.EndPinch();e.touchState=0}}}function mt(t){var i=rt(t),e=i&&Dt.tc[i];if(e&&t.changedTouches){switch(e.touchState){case 1:e.Draw();e.Clicked();break;case 2:e.EndDrag();break;case 3:e.EndPinch()}e.touchState=0}}function pt(t){var i,e=Dt,s,h,n=rt(t);for(i in e.tc){s=e.tc[i];if(s.tttimer){clearTimeout(s.tttimer);s.tttimer=null}}s=n&&e.tc[n];if(s&&t.changedTouches&&s.touchState){switch(s.touchState){case 1:case 2:if(h=lt(t,s.canvas)){s.mx=h.x;s.my=h.y;if(s.Drag(t,h))s.touchState=2}break;case 3:s.Pinch(t)}s.drawn=0}}function wt(t){var i=Dt,e=rt(t);if(e&&i.tc[e]){t.cancelBubble=true;t.returnValue=false;t.preventDefault&&t.preventDefault();i.tc[e].Wheel((t.wheelDelta||t.detail)>0)}}function xt(t){var i,e=Dt;clearTimeout(e.scrollTimer);for(i in e.tc){e.tc[i].Pause()}e.scrollTimer=setTimeout(function(){var t,i=Dt;for(t in i.tc){i.tc[t].Resume()}},e.scrollPause)}function vt(){yt(I())}function yt(t){var i=Dt.tc,e;Dt.NextFrame(Dt.interval);t=t||I();for(e in i)i[e].Draw(t)}function Tt(t){var i=T.getElementById(t),e=i.getBoundingClientRect(),s=T.documentElement,h=T.body,n=window,a=n.pageXOffset||s.scrollLeft,o=n.pageYOffset||s.scrollTop,r=s.clientLeft||h.clientLeft,l=s.clientTop||h.clientTop;return{x:e.left+a-r,y:e.top+o-l}}function St(t,i,e,s){var h=t.radius*t.z1/(t.z1+t.z2+i.z);return{x:i.x*h*e,y:i.y*h*s,z:i.z,w:(t.z1-i.z)/t.z2}}function bt(t){this.e=t;this.br=0;this.line=[];this.text=[];this.original=t.innerText||t.textContent}v=bt.prototype;v.Empty=function(){for(var t=0;t<this.text.length;++t)if(this.text[t].length)return false;return true};v.Lines=function(t){var i=t?1:0,e,s,h;t=t||this.e;e=t.childNodes;s=e.length;for(h=0;h<s;++h){if(e[h].nodeName=="BR"){this.text.push(this.line.join(" "));this.br=1}else if(e[h].nodeType==3){if(this.br){this.line=[e[h].nodeValue];this.br=0}else{this.line.push(e[h].nodeValue)}}else{this.Lines(e[h])}}i||this.br||this.text.push(this.line.join(" "));return this.text};v.SplitWidth=function(t,i,e,s){var h,n,a,o=[];i.font=s+"px "+e;for(h=0;h<this.text.length;++h){a=this.text[h].split(/\s+/);this.line=[a[0]];for(n=1;n<a.length;++n){if(i.measureText(this.line.join(" ")+" "+a[n]).width>t){o.push(this.line.join(" "));this.line=[a[n]]}else{this.line.push(a[n])}}o.push(this.line.join(" "))}return this.text=o};function Ct(t,i){this.ts=null;this.tc=t;this.tag=i;this.x=this.y=this.w=this.h=this.sc=1;this.z=0;this.pulse=1;this.pulsate=t.pulsateTo<1;this.colour=t.outlineColour;this.adash=~~t.outlineDash;this.agap=~~t.outlineDashSpace||this.adash;this.aspeed=t.outlineDashSpeed*1;if(this.colour=="tag")this.colour=at(i.a,"color");else if(this.colour=="tagbg")this.colour=at(i.a,"background-color");this.Draw=this.pulsate?this.DrawPulsate:this.DrawSimple;this.radius=t.outlineRadius|0;this.SetMethod(t.outlineMethod)}d=Ct.prototype;d.SetMethod=function(t){var i={block:["PreDraw","DrawBlock"],colour:["PreDraw","DrawColour"],outline:["PostDraw","DrawOutline"],classic:["LastDraw","DrawOutline"],size:["PreDraw","DrawSize"],none:["LastDraw"]},e=i[t]||i.outline;if(t=="none"){this.Draw=function(){return 1}}else{this.drawFunc=this[e[1]]}this[e[0]]=this.Draw};d.Update=function(t,i,e,s,h,n,a,o){var r=this.tc.outlineOffset,l=2*r;this.x=h*t+a-r;this.y=h*i+o-r;this.w=h*e+l;this.h=h*s+l;this.sc=h;this.z=n};d.Ants=function(t){if(!this.adash)return;var i=this.adash,e=this.agap,h=this.aspeed,n=i+e,a=0,o=i,r=e,l=0,f=0,u;if(h){f=s(h)*(I()-this.ts)/50;if(h<0)f=864e4-f;h=~~f%n}if(h){if(i>=h){a=i-h;o=h}else{r=n-h;l=e-r}u=[a,r,o,l]}else{u=[i,e]}t.setLineDash(u)};d.DrawOutline=function(t,i,e,s,h,n){var a=o(this.radius,h/2,s/2);t.strokeStyle=n;this.Ants(t);j(t,i,e,s,h,a,true)};d.DrawSize=function(t,i,e,s,h,n,a,o,r){var l=a.w,f=a.h,u,g,c;if(this.pulsate){if(a.image)c=(a.image.height+this.tc.outlineIncrease)/a.image.height;else c=a.oscale;g=a.fimage||a.image;u=1+(c-1)*(1-this.pulse);a.h*=u;a.w*=u}else{g=a.oimage}a.alpha=1;a.Draw(t,o,r,g);a.h=f;a.w=l;return 1};d.DrawColour=function(t,i,e,s,h,n,a,o,r){if(a.oimage){if(this.pulse<1){a.alpha=1-f(this.pulse,2);a.Draw(t,o,r,a.fimage);a.alpha=this.pulse}else{a.alpha=1}a.Draw(t,o,r,a.oimage);return 1}return this[a.image?"DrawColourImage":"DrawColourText"](t,i,e,s,h,n,a,o,r)};d.DrawColourText=function(t,i,e,s,h,n,a,o,r){var l=a.colour;a.colour=n;a.alpha=1;a.Draw(t,o,r);a.colour=l;return 1};d.DrawColourImage=function(t,i,e,s,h,n,r,l,u){var g=t.canvas,c=~~a(i,0),d=~~a(e,0),m=o(g.width-c,s)+.5|0,p=o(g.height-d,h)+.5|0,w;if(S)S.width=m,S.height=p;else S=Y(m,p);if(!S)return this.SetMethod("outline");w=S.getContext("2d");w.drawImage(g,c,d,m,p,0,0,m,p);t.clearRect(c,d,m,p);if(this.pulsate){r.alpha=1-f(this.pulse,2)}else{r.alpha=1}r.Draw(t,l,u);t.setTransform(1,0,0,1,0,0);t.save();t.beginPath();t.rect(c,d,m,p);t.clip();t.globalCompositeOperation="source-in";t.fillStyle=n;t.fillRect(c,d,m,p);t.restore();t.globalAlpha=1;t.globalCompositeOperation="destination-over";t.drawImage(S,0,0,m,p,c,d,m,p);t.globalCompositeOperation="source-over";return 1};d.DrawBlock=function(t,i,e,s,h,n){var a=o(this.radius,h/2,s/2);t.fillStyle=n;j(t,i,e,s,h,a)};d.DrawSimple=function(t,i,e,s,h,n){var a=this.tc;t.setTransform(1,0,0,1,0,0);t.strokeStyle=this.colour;t.lineWidth=a.outlineThickness;t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0;t.globalAlpha=n?h:1;return this.drawFunc(t,this.x,this.y,this.w,this.h,this.colour,i,e,s)};d.DrawPulsate=function(t,i,e,s){var h=I()-this.ts,a=this.tc,o=a.pulsateTo+(1-a.pulsateTo)*(.5+n(2*Math.PI*h/(1e3*a.pulsateTime))/2);this.pulse=o=Dt.Smooth(1,o);return this.DrawSimple(t,i,e,s,o,1)};d.Active=function(t,i,e){var s=i>=this.x&&e>=this.y&&i<=this.x+this.w&&e<=this.y+this.h;if(s){this.ts=this.ts||I()}else{this.ts=null}return s};d.PreDraw=d.PostDraw=d.LastDraw=A;function zt(t,i,e,s,h,n,a,o,r,l,f,u,g,c){this.tc=t;this.image=null;this.text=i;this.text_original=c;this.line_widths=[];this.title=e.title||null;this.a=e;this.position=new O(s[0],s[1],s[2]);this.x=this.y=this.z=0;this.w=h;this.h=n;this.colour=a||t.textColour;this.bgColour=o||t.bgColour;this.bgRadius=r|0;this.bgOutline=l||this.colour;this.bgOutlineThickness=f|0;this.textFont=u||t.textFont;this.padding=g|0;this.sc=this.alpha=1;this.weighted=!t.weight;this.outline=new Ct(t,this)}m=zt.prototype;m.Init=function(t){var i=this.tc;this.textHeight=i.textHeight;if(this.HasText()){this.Measure(i.ctxt,i)}else{this.w=this.iw;this.h=this.ih}this.SetShadowColour=i.shadowAlpha?this.SetShadowColourAlpha:this.SetShadowColourFixed;this.SetDraw(i)};m.Draw=A;m.HasText=function(){return this.text&&this.text[0].length>0};m.EqualTo=function(t){var i=t.getElementsByTagName("img");if(this.a.href!=t.href)return 0;if(i.length)return this.image.src==i[0].src;return(t.innerText||t.textContent)==this.text_original};m.SetImage=function(t){this.image=this.fimage=t};m.SetDraw=function(t){this.Draw=this.fimage?t.ie>7?this.DrawImageIE:this.DrawImage:this.DrawText;t.noSelect&&(this.CheckActive=A)};m.MeasureText=function(t){var i,e=this.text.length,s=0,h;for(i=0;i<e;++i){this.line_widths[i]=h=t.measureText(this.text[i]).width;s=a(s,h)}return s};m.Measure=function(t,i){var e=it(this.text,this.textFont,this.textHeight),s,h,n,a,o,r,l,f,u;l=e?e.max.y+e.min.y:this.textHeight;t.font=this.font=this.textHeight+"px "+this.textFont;r=this.MeasureText(t);if(i.txtOpt){s=i.txtScale;h=s*this.textHeight;n=h+"px "+this.textFont;a=[s*i.shadowOffset[0],s*i.shadowOffset[1]];t.font=n;o=this.MeasureText(t);u=new Z(this.text,n,o+s,s*l+s,o,this.line_widths,i.textAlign,i.textVAlign,s);if(this.image)u.SetImage(this.image,this.iw,this.ih,i.imagePosition,i.imagePadding,i.imageAlign,i.imageVAlign,i.imageScale);f=u.Create(this.colour,this.bgColour,this.bgOutline,s*this.bgOutlineThickness,i.shadow,s*i.shadowBlur,a,s*this.padding,s*this.bgRadius);if(i.outlineMethod=="colour"){this.oimage=u.Create(this.outline.colour,this.bgColour,this.outline.colour,s*this.bgOutlineThickness,i.shadow,s*i.shadowBlur,a,s*this.padding,s*this.bgRadius)}else if(i.outlineMethod=="size"){e=it(this.text,this.textFont,this.textHeight+i.outlineIncrease);h=e.max.y+e.min.y;n=s*(this.textHeight+i.outlineIncrease)+"px "+this.textFont;t.font=n;o=this.MeasureText(t);u=new Z(this.text,n,o+s,s*h+s,o,this.line_widths,i.textAlign,i.textVAlign,s);if(this.image)u.SetImage(this.image,this.iw+i.outlineIncrease,this.ih+i.outlineIncrease,i.imagePosition,i.imagePadding,i.imageAlign,i.imageVAlign,i.imageScale);this.oimage=u.Create(this.colour,this.bgColour,this.bgOutline,s*this.bgOutlineThickness,i.shadow,s*i.shadowBlur,a,s*this.padding,s*this.bgRadius);this.oscale=this.oimage.width/f.width;if(i.outlineIncrease>0)f=Q(f,this.oimage.width,this.oimage.height);else this.oimage=Q(this.oimage,f.width,f.height)}if(f){this.fimage=f;r=this.fimage.width/s;l=this.fimage.height/s}this.SetDraw(i);i.txtOpt=!!this.fimage}this.h=l;this.w=r};m.SetFont=function(t,i,e,s){this.textFont=t;this.colour=i;this.bgColour=e;this.bgOutline=s;this.Measure(this.tc.ctxt,this.tc)};m.SetWeight=function(t){var i=this.tc,e=i.weightMode.split(/[, ]/),s,h,n=t.length;if(!this.HasText())return;this.weighted=true;for(h=0;h<n;++h){s=e[h]||"size";if("both"==s){this.Weight(t[h],i.ctxt,i,"size",i.min_weight[h],i.max_weight[h],h);this.Weight(t[h],i.ctxt,i,"colour",i.min_weight[h],i.max_weight[h],h)}else{this.Weight(t[h],i.ctxt,i,s,i.min_weight[h],i.max_weight[h],h)}}this.Measure(i.ctxt,i)};m.Weight=function(t,i,e,s,h,n,o){t=isNaN(t)?1:t;var r=(t-h)/(n-h);if("colour"==s)this.colour=q(e,r,o);else if("bgcolour"==s)this.bgColour=q(e,r,o);else if("bgoutline"==s)this.bgOutline=q(e,r,o);else if("outline"==s)this.outline.colour=q(e,r,o);else if("size"==s){if(e.weightSizeMin>0&&e.weightSizeMax>e.weightSizeMin){this.textHeight=e.weightSize*(e.weightSizeMin+(e.weightSizeMax-e.weightSizeMin)*r)}else{this.textHeight=a(1,t*e.weightSize)}}};m.SetShadowColourFixed=function(t,i,e){t.shadowColor=i};m.SetShadowColourAlpha=function(t,i,e){t.shadowColor=X(i,e)};m.DrawText=function(t,i,e){var s=this.tc,h=this.x,n=this.y,a=this.sc,o,r;t.globalAlpha=this.alpha;t.fillStyle=this.colour;s.shadow&&this.SetShadowColour(t,s.shadow,this.alpha);t.font=this.font;h+=i/a;n+=e/a-this.h/2;for(o=0;o<this.text.length;++o){r=h;if("right"==s.textAlign){r+=this.w/2-this.line_widths[o]}else if("centre"==s.textAlign){r-=this.line_widths[o]/2}else{r-=this.w/2}t.setTransform(a,0,0,a,a*r,a*n);t.fillText(this.text[o],0,0);n+=this.textHeight}};m.DrawImage=function(t,i,e,s){var h=this.x,n=this.y,a=this.sc,o=s||this.fimage,r=this.w,l=this.h,f=this.alpha,u=this.shadow;t.globalAlpha=f;u&&this.SetShadowColour(t,u,f);h+=i/a-r/2;n+=e/a-l/2;t.setTransform(a,0,0,a,a*h,a*n);t.drawImage(o,0,0,r,l)};m.DrawImageIE=function(t,i,e){var s=this.fimage,h=this.sc,n=s.width=this.w*h,a=s.height=this.h*h,o=this.x*h+i-n/2,r=this.y*h+e-a/2;t.setTransform(1,0,0,1,0,0);t.globalAlpha=this.alpha;t.drawImage(s,o,r)};m.Calc=function(t,i){var e,s=this.tc,h=s.minBrightness,n=s.maxBrightness,a=s.max_radius;e=t.xform(this.position);this.xformed=e;e=St(s,e,s.stretchX,s.stretchY);this.x=e.x;this.y=e.y;this.z=e.z;this.sc=e.w;this.alpha=i*D(h+(n-h)*(a-this.z)/(2*a),0,1);return this.xformed};m.UpdateActive=function(t,i,e){var s=this.outline,h=this.w,n=this.h,a=this.x-h/2,o=this.y-n/2;s.Update(a,o,h,n,this.sc,this.z,i,e);return s};m.CheckActive=function(t,i,e){var s=this.tc,h=this.UpdateActive(t,i,e);return h.Active(t,s.mx,s.my)?h:null};m.Clicked=function(t){var i=this.a,e=i.target,s=i.href,h;if(e!=""&&e!="_self"){if(self.frames[e]){self.frames[e].document.location=s}else{try{if(top.frames[e]){top.frames[e].document.location=s;return}}catch(n){}window.open(s,e)}return}if(T.createEvent){h=T.createEvent("MouseEvents");h.initMouseEvent("click",1,1,window,0,0,0,0,0,0,0,0,0,0,null);if(!i.dispatchEvent(h))return}else if(i.fireEvent){if(!i.fireEvent("onclick"))return}T.location=s};function Dt(t,i,e){var s,h,n=T.getElementById(t),l=["id","class","innerHTML"],f;if(!n)throw 0;if(C(window.G_vmlCanvasManager)){n=window.G_vmlCanvasManager.initElement(n);this.ie=parseFloat(navigator.appVersion.split("MSIE")[1])}if(n&&(!n.getContext||!n.getContext("2d").fillText)){h=T.createElement("DIV");for(s=0;s<l.length;++s)h[l[s]]=n[l[s]];n.parentNode.insertBefore(h,n);n.parentNode.removeChild(n);throw 0}for(s in Dt.options)this[s]=e&&C(e[s])?e[s]:C(Dt[s])?Dt[s]:Dt.options[s];this.canvas=n;this.ctxt=n.getContext("2d");this.z1=250/a(this.depth,.001);this.z2=this.z1/this.zoom;this.radius=o(n.height,n.width)*.0075;this.max_radius=100;this.max_weight=[];this.min_weight=[];this.textFont=this.textFont&&et(this.textFont);this.textHeight*=1;this.imageRadius=this.imageRadius.toString();this.pulsateTo=D(this.pulsateTo,0,1);this.minBrightness=D(this.minBrightness,0,1);this.maxBrightness=D(this.maxBrightness,this.minBrightness,1);this.ctxt.textBaseline="top";this.lx=(this.lock+"").indexOf("x")+1;this.ly=(this.lock+"").indexOf("y")+1;this.frozen=this.dx=this.dy=this.fixedAnim=this.touchState=0;this.fixedAlpha=1;this.source=i||t;this.repeatTags=o(64,~~this.repeatTags);this.minTags=o(200,~~this.minTags);if(~~this.scrollPause>0)Dt.scrollPause=~~this.scrollPause;else this.scrollPause=0;if(this.minTags>0&&this.repeatTags<1&&(s=this.GetTags().length))this.repeatTags=r(this.minTags/s)-1;this.transform=P.Identity();this.startTime=this.time=I();this.mx=this.my=-1;this.centreImage&&W(this);this.Animate=this.dragControl?this.AnimateDrag:this.AnimatePosition;this.animTiming=typeof Dt[this.animTiming]=="function"?Dt[this.animTiming]:Dt.Smooth;if(this.shadowBlur||this.shadowOffset[0]||this.shadowOffset[1]){this.ctxt.shadowColor=this.shadow;this.shadow=this.ctxt.shadowColor;this.shadowAlpha=U()}else{delete this.shadow}this.Load();if(i&&this.hideTags){(function(t){if(Dt.loaded)t.HideTags();else st("load",function(){t.HideTags()},window)})(this)}this.yaw=this.initial?this.initial[0]*this.maxSpeed:0;this.pitch=this.initial?this.initial[1]*this.maxSpeed:0;if(this.tooltip){this.ctitle=n.title;n.title="";if(this.tooltip=="native"){this.Tooltip=this.TooltipNative}else{this.Tooltip=this.TooltipDiv;if(!this.ttdiv){this.ttdiv=T.createElement("div");this.ttdiv.className=this.tooltipClass;this.ttdiv.style.position="absolute";this.ttdiv.style.zIndex=n.style.zIndex+1;st("mouseover",function(t){t.target.style.display="none"},this.ttdiv);T.body.appendChild(this.ttdiv)}}}else{this.Tooltip=this.TooltipNone}if(!this.noMouse&&!b[t]){b[t]=[["mousemove",ut],["mouseout",ft],["mouseup",ct],["touchstart",dt],["touchend",mt],["touchcancel",mt],["touchmove",pt]];if(this.dragControl){b[t].push(["mousedown",gt]);b[t].push(["selectstart",A])}if(this.wheelZoom){b[t].push(["mousewheel",wt]);b[t].push(["DOMMouseScroll",wt])}if(this.scrollPause){b[t].push(["scroll",xt,window])}for(s=0;s<b[t].length;++s){h=b[t][s];st(h[0],h[1],h[2]?h[2]:n)}}if(!Dt.started){f=window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;Dt.NextFrame=f?Dt.NextFrameRAF:Dt.NextFrameTimeout;Dt.interval=this.interval;Dt.NextFrame(this.interval);Dt.started=1}}p=Dt.prototype;p.SourceElements=function(){if(T.querySelectorAll)return T.querySelectorAll("#"+this.source);return[T.getElementById(this.source)]};p.HideTags=function(){var t=this.SourceElements(),i;for(i=0;i<t.length;++i)t[i].style.display="none"};p.GetTags=function(){var t=this.SourceElements(),i,e=[],s,h,n;for(n=0;n<=this.repeatTags;++n){for(s=0;s<t.length;++s){i=t[s].getElementsByTagName("a");for(h=0;h<i.length;++h){e.push(i[h])}}}return e};p.Message=function(t){var i=[],e,s,a=t.split(""),o,r,l,f;for(e=0;e<a.length;++e){if(a[e]!=" "){s=e-a.length/2;o=T.createElement("A");o.href="#";o.innerText=a[e];l=100*h(s/9);f=-100*n(s/9);r=new zt(this,a[e],o,[l,0,f],2,18,"#000","#fff",0,0,0,"monospace",2,a[e]);r.Init();i.push(r)}}return i};p.CreateTag=function(t){var i,e,s,h,n,a,o,r,l=[0,0,0];if("text"!=this.imageMode){i=t.getElementsByTagName("img");if(i.length){e=new Image;e.src=i[0].src;if(!this.imageMode){s=new zt(this,"",t,l,0,0);s.SetImage(e);nt(e,i[0],s,this);return s}}}if("image"!=this.imageMode){n=new bt(t);h=n.Lines();if(!n.Empty()){a=this.textFont||et(at(t,"font-family"));if(this.splitWidth)h=n.SplitWidth(this.splitWidth,this.ctxt,a,this.textHeight);o=this.bgColour=="tag"?at(t,"background-color"):this.bgColour;r=this.bgOutline=="tag"?at(t,"color"):this.bgOutline}else{n=null}}if(n||e){s=new zt(this,h,t,l,2,this.textHeight+2,this.textColour||at(t,"color"),o,this.bgRadius,r,this.bgOutlineThickness,a,this.padding,n&&n.original);if(e){s.SetImage(e);nt(e,i[0],s,this)}else{s.Init()}return s}};p.UpdateTag=function(t,i){var e=this.textColour||at(i,"color"),s=this.textFont||et(at(i,"font-family")),h=this.bgColour=="tag"?at(i,"background-color"):this.bgColour,n=this.bgOutline=="tag"?at(i,"color"):this.bgOutline;t.a=i;t.title=i.title;if(t.colour!=e||t.textFont!=s||t.bgColour!=h||t.bgOutline!=n)t.SetFont(s,e,h,n)};p.Weight=function(t){var i=t.length,e,s,h,n=[],a,o=this.weightFrom?this.weightFrom.split(/[, ]/):[null],r=o.length;for(s=0;s<i;++s){n[s]=[];for(h=0;h<r;++h){e=ot(t[s].a,o[h],this.textHeight);if(!this.max_weight[h]||e>this.max_weight[h])this.max_weight[h]=e;if(!this.min_weight[h]||e<this.min_weight[h])this.min_weight[h]=e;n[s][h]=e}}for(h=0;h<r;++h){if(this.max_weight[h]>this.min_weight[h])a=1}if(a){for(s=0;s<i;++s){t[s].SetWeight(n[s])}}};p.Load=function(){var t=this.GetTags(),i=[],e,s,h,n,o,r,l,f,u=[],g={sphere:E,vcylinder:N,hcylinder:_,vring:L,hring:H};if(t.length){u.length=t.length;for(f=0;f<t.length;++f)u[f]=f;this.shuffleTags&&F(u);n=100*this.radiusX;o=100*this.radiusY;r=100*this.radiusZ;this.max_radius=a(n,a(o,r));for(f=0;f<t.length;++f){s=this.CreateTag(t[u[f]]);if(s)i.push(s)}this.weight&&this.Weight(i,true);if(this.shapeArgs){this.shapeArgs[0]=i.length}else{h=this.shape.toString().split(/[(),]/);e=h.shift();if(typeof window[e]==="function")this.shape=window[e];else this.shape=g[e]||g.sphere;this.shapeArgs=[i.length,n,o,r].concat(h)}l=this.shape.apply(this,this.shapeArgs);this.listLength=i.length;for(f=0;f<i.length;++f)i[f].position=new O(l[f][0],l[f][1],l[f][2])}if(this.noTagsMessage&&!i.length){f=this.imageMode&&this.imageMode!="both"?this.imageMode+" ":"";i=this.Message("No "+f+"tags")}this.taglist=i};p.Update=function(){var t=this.GetTags(),i=[],e=this.taglist,s,h=[],n=[],a,o,l,f,u;if(!this.shapeArgs)return this.Load();if(t.length){l=this.listLength=t.length;o=e.length;for(f=0;f<o;++f){i.push(e[f]);n.push(f)}for(f=0;f<l;++f){for(u=0,s=0;u<o;++u){if(e[u].EqualTo(t[f])){this.UpdateTag(i[u],t[f]);s=n[u]=-1}}if(!s)h.push(f)}for(f=0,u=0;f<o;++f){if(n[u]==-1)n.splice(u,1);else++u}if(n.length){F(n);while(n.length&&h.length){f=n.shift();u=h.shift();i[f]=this.CreateTag(t[u])}n.sort(function(t,i){return t-i});while(n.length){i.splice(n.pop(),1)}}u=i.length/(h.length+1);f=0;while(h.length){i.splice(r(++f*u),0,this.CreateTag(t[h.shift()]))}this.shapeArgs[0]=l=i.length;a=this.shape.apply(this,this.shapeArgs);for(f=0;f<l;++f)i[f].position=new O(a[f][0],a[f][1],a[f][2]);this.weight&&this.Weight(i)}this.taglist=i};p.SetShadow=function(t){t.shadowBlur=this.shadowBlur;t.shadowOffsetX=this.shadowOffset[0];t.shadowOffsetY=this.shadowOffset[1]};p.Draw=function(t){if(this.paused)return;var i=this.canvas,e=i.width,s=i.height,h=0,n=(t-this.time)*Dt.interval/1e3,a=e/2+this.offsetX,o=s/2+this.offsetY,r=this.ctxt,l,f,u,g=-1,c=this.taglist,d=c.length,m=this.frontSelect,p=this.centreFunc==A,w;this.time=t;if(this.frozen&&this.drawn)return this.Animate(e,s,n);w=this.AnimateFixed();r.setTransform(1,0,0,1,0,0);for(u=0;u<d;++u)c[u].Calc(this.transform,this.fixedAlpha);c=M(c,function(t,i){return i.z-t.z});if(w&&this.fixedAnim.active){l=this.fixedAnim.tag.UpdateActive(r,a,o)}else{this.active=null;for(u=0;u<d;++u){f=this.mx>=0&&this.my>=0&&this.taglist[u].CheckActive(r,a,o);if(f&&f.sc>h&&(!m||f.z<=0)){
l=f;g=u;l.tag=this.taglist[u];h=f.sc}}this.active=l}this.txtOpt||this.shadow&&this.SetShadow(r);r.clearRect(0,0,e,s);for(u=0;u<d;++u){if(!p&&c[u].z<=0){try{this.centreFunc(r,e,s,a,o)}catch(x){alert(x);this.centreFunc=A}p=true}if(!(l&&l.tag==c[u]&&l.PreDraw(r,c[u],a,o)))c[u].Draw(r,a,o);l&&l.tag==c[u]&&l.PostDraw(r)}if(this.freezeActive&&l){this.Freeze()}else{this.UnFreeze();this.drawn=d==this.listLength}if(this.fixedCallback){this.fixedCallback(this,this.fixedCallbackTag);this.fixedCallback=null}w||this.Animate(e,s,n);l&&l.LastDraw(r);i.style.cursor=l?this.activeCursor:"";this.Tooltip(l,this.taglist[g])};p.TooltipNone=function(){};p.TooltipNative=function(t,i){if(t)this.canvas.title=i&&i.title?i.title:"";else this.canvas.title=this.ctitle};p.SetTTDiv=function(t,i){var e=this,s=e.ttdiv.style;if(t!=e.ttdiv.innerHTML)s.display="none";e.ttdiv.innerHTML=t;i&&(i.title=e.ttdiv.innerHTML);if(s.display=="none"&&!e.tttimer){e.tttimer=setTimeout(function(){var t=Tt(e.canvas.id);s.display="block";s.left=t.x+e.mx+"px";s.top=t.y+e.my+24+"px";e.tttimer=null},e.tooltipDelay)}};p.TooltipDiv=function(t,i){if(t&&i&&i.title){this.SetTTDiv(i.title,i)}else if(!t&&this.mx!=-1&&this.my!=-1&&this.ctitle.length){this.SetTTDiv(this.ctitle)}else{this.ttdiv.style.display="none"}};p.Transform=function(t,i,e){if(i||e){var s=h(i),a=n(i),o=h(e),r=n(e),l=new P([r,0,o,0,1,0,-o,0,r]),f=new P([1,0,0,0,a,-s,0,s,a]);t.transform=t.transform.mul(l.mul(f))}};p.AnimateFixed=function(){var t,i,e,s,h;if(this.fadeIn){i=I()-this.startTime;if(i>=this.fadeIn){this.fadeIn=0;this.fixedAlpha=1}else{this.fixedAlpha=i/this.fadeIn}}if(this.fixedAnim){if(!this.fixedAnim.transform)this.fixedAnim.transform=this.transform;t=this.fixedAnim,i=I()-t.t0,e=t.angle,s,h=this.animTiming(t.t,i);this.transform=t.transform;if(i>=t.t){this.fixedCallbackTag=t.tag;this.fixedCallback=t.cb;this.fixedAnim=this.yaw=this.pitch=0}else{e*=h}s=P.Rotation(e,t.axis);this.transform=this.transform.mul(s);return this.fixedAnim!=0}return false};p.AnimatePosition=function(t,i,e){var s=this,h=s.mx,n=s.my,a,o;if(!s.frozen&&h>=0&&n>=0&&h<t&&n<i){a=s.maxSpeed,o=s.reverse?-1:1;s.lx||(s.yaw=(h*2*a/t-a)*o*e);s.ly||(s.pitch=(n*2*a/i-a)*-o*e);s.initial=null}else if(!s.initial){if(s.frozen&&!s.freezeDecel)s.yaw=s.pitch=0;else s.Decel(s)}this.Transform(s,s.pitch,s.yaw)};p.AnimateDrag=function(t,i,e){var s=this,h=100*e*s.maxSpeed/s.max_radius/s.zoom;if(s.dx||s.dy){s.lx||(s.yaw=s.dx*h/s.stretchX);s.ly||(s.pitch=s.dy*-h/s.stretchY);s.dx=s.dy=0;s.initial=null}else if(!s.initial){s.Decel(s)}this.Transform(s,s.pitch,s.yaw)};p.Freeze=function(){if(!this.frozen){this.preFreeze=[this.yaw,this.pitch];this.frozen=1;this.drawn=0}};p.UnFreeze=function(){if(this.frozen){this.yaw=this.preFreeze[0];this.pitch=this.preFreeze[1];this.frozen=0}};p.Decel=function(t){var i=t.minSpeed,e=s(t.yaw),h=s(t.pitch);if(!t.lx&&e>i)t.yaw=e>t.z0?t.yaw*t.decel:0;if(!t.ly&&h>i)t.pitch=h>t.z0?t.pitch*t.decel:0};p.Zoom=function(t){this.z2=this.z1*(1/t);this.drawn=0};p.Clicked=function(t){var i=this.active;try{if(i&&i.tag)if(this.clickToFront===false||this.clickToFront===null)i.tag.Clicked(t);else this.TagToFront(i.tag,this.clickToFront,function(){i.tag.Clicked(t)},true)}catch(e){}};p.Wheel=function(t){var i=this.zoom+this.zoomStep*(t?1:-1);this.zoom=o(this.zoomMax,a(this.zoomMin,i));this.Zoom(this.zoom)};p.BeginDrag=function(t){this.down=lt(t,this.canvas);t.cancelBubble=true;t.returnValue=false;t.preventDefault&&t.preventDefault()};p.Drag=function(t,i){if(this.dragControl&&this.down){var e=this.dragThreshold*this.dragThreshold,s=i.x-this.down.x,h=i.y-this.down.y;if(this.dragging||s*s+h*h>e){this.dx=s;this.dy=h;this.dragging=1;this.down=i}}return this.dragging};p.EndDrag=function(){var t=this.dragging;this.dragging=this.down=null;return t};function At(t){var i=t.targetTouches[0],e=t.targetTouches[1];return l(f(e.pageX-i.pageX,2)+f(e.pageY-i.pageY,2))}p.BeginPinch=function(t){this.pinched=[At(t),this.zoom];t.preventDefault&&t.preventDefault()};p.Pinch=function(t){var i,e,s=this.pinched;if(!s)return;e=At(t);i=s[1]*e/s[0];this.zoom=o(this.zoomMax,a(this.zoomMin,i));this.Zoom(this.zoom)};p.EndPinch=function(t){this.pinched=null};p.Pause=function(){this.paused=true};p.Resume=function(){this.paused=false};p.SetSpeed=function(t){this.initial=t;this.yaw=t[0]*this.maxSpeed;this.pitch=t[1]*this.maxSpeed};p.FindTag=function(t){if(!C(t))return null;C(t.index)&&(t=t.index);if(!z(t))return this.taglist[t];var i,e,s;if(C(t.id))i="id",e=t.id;else if(C(t.text))i="innerText",e=t.text;for(s=0;s<this.taglist.length;++s)if(this.taglist[s].a[i]==e)return this.taglist[s]};p.RotateTag=function(t,i,e,s,h,n){var a=t.Calc(this.transform,1),o=new O(a.x,a.y,a.z),r=k(e,i),l=o.angle(r),f=o.cross(r).unit();if(l==0){this.fixedCallbackTag=t;this.fixedCallback=h}else{this.fixedAnim={angle:-l,axis:f,t:s,t0:I(),cb:h,tag:t,active:n}}};p.TagToFront=function(t,i,e,s){this.RotateTag(t,0,0,i,e,s)};Dt.Start=function(t,i,e){Dt.Delete(t);Dt.tc[t]=new Dt(t,i,e)};function It(t,i){Dt.tc[i]&&Dt.tc[i][t]()}Dt.Linear=function(t,i){return i/t};Dt.Smooth=function(t,i){return.5-n(i*Math.PI/t)/2};Dt.Pause=function(t){It("Pause",t)};Dt.Resume=function(t){It("Resume",t)};Dt.Reload=function(t){It("Load",t)};Dt.Update=function(t){It("Update",t)};Dt.SetSpeed=function(t,i){if(z(i)&&Dt.tc[t]&&!isNaN(i[0])&&!isNaN(i[1])){Dt.tc[t].SetSpeed(i);return true}return false};Dt.TagToFront=function(t,i){if(!z(i))return false;i.lat=i.lng=0;return Dt.RotateTag(t,i)};Dt.RotateTag=function(t,i){if(z(i)&&Dt.tc[t]){if(isNaN(i.time))i.time=500;var e=Dt.tc[t].FindTag(i);if(e){Dt.tc[t].RotateTag(e,i.lat,i.lng,i.time,i.callback,i.active);return true}}return false};Dt.Delete=function(t){var i,e;if(b[t]){e=T.getElementById(t);if(e){for(i=0;i<b[t].length;++i)ht(b[t][i][0],b[t][i][1],e)}}delete b[t];delete Dt.tc[t]};Dt.NextFrameRAF=function(){requestAnimationFrame(yt)};Dt.NextFrameTimeout=function(t){setTimeout(vt,t)};Dt.tc={};Dt.options={z1:2e4,z2:2e4,z0:2e-4,freezeActive:false,freezeDecel:false,activeCursor:"pointer",pulsateTo:1,pulsateTime:3,reverse:false,depth:.5,maxSpeed:.05,minSpeed:0,decel:.95,interval:20,minBrightness:.1,maxBrightness:1,outlineColour:"#ffff99",outlineThickness:2,outlineOffset:5,outlineMethod:"outline",outlineRadius:0,textColour:"#ff99ff",textHeight:15,textFont:"Helvetica, Arial, sans-serif",shadow:"#000",shadowBlur:0,shadowOffset:[0,0],initial:null,hideTags:true,zoom:1,weight:false,weightMode:"size",weightFrom:null,weightSize:1,weightSizeMin:null,weightSizeMax:null,weightGradient:{0:"#f00",.33:"#ff0",.66:"#0f0",1:"#00f"},txtOpt:true,txtScale:2,frontSelect:false,wheelZoom:true,zoomMin:.3,zoomMax:3,zoomStep:.05,shape:"sphere",lock:null,tooltip:null,tooltipDelay:300,tooltipClass:"tctooltip",radiusX:1,radiusY:1,radiusZ:1,stretchX:1,stretchY:1,offsetX:0,offsetY:0,shuffleTags:false,noSelect:false,noMouse:false,imageScale:1,paused:false,dragControl:false,dragThreshold:4,centreFunc:A,splitWidth:0,animTiming:"Smooth",clickToFront:false,fadeIn:0,padding:0,bgColour:null,bgRadius:0,bgOutline:null,bgOutlineThickness:0,outlineIncrease:4,textAlign:"centre",textVAlign:"middle",imageMode:null,imagePosition:null,imagePadding:2,imageAlign:"centre",imageVAlign:"middle",noTagsMessage:true,centreImage:null,pinchZoom:false,repeatTags:0,minTags:0,imageRadius:0,scrollPause:false,outlineDash:0,outlineDashSpace:0,outlineDashSpeed:1};for(i in Dt.options)Dt[i]=Dt.options[i];window.TagCanvas=Dt;jQuery.fn.tagcanvas=function(i,e){var s={pause:function(){t(this).each(function(){It("Pause",t(this)[0].id)})},resume:function(){t(this).each(function(){It("Resume",t(this)[0].id)})},reload:function(){t(this).each(function(){It("Load",t(this)[0].id)})},update:function(){t(this).each(function(){It("Update",t(this)[0].id)})},tagtofront:function(){t(this).each(function(){Dt.TagToFront(t(this)[0].id,e)})},rotatetag:function(){t(this).each(function(){Dt.RotateTag(t(this)[0].id,e)})},"delete":function(){t(this).each(function(){Dt.Delete(t(this)[0].id)})},setspeed:function(){t(this).each(function(){Dt.SetSpeed(t(this)[0].id,e)})}};if(typeof i=="string"&&s[i]){s[i].apply(this);return this}else{Dt.jquery=1;t(this).each(function(){Dt.Start(t(this)[0].id,e,i)});return Dt.started}};st("load",function(){Dt.loaded=1},window)})(jQuery);
//rebuild by neat 